{% extends "base.html" %}
{% block title %}Adaptive Trails ¬∑ Start{% endblock %}
{% block page_class %}home-page{% endblock %}
{% block content %}
    <div class="hero-grid">
        <div class="hero-panel">
            <header>
                <h1>üèîÔ∏è Hiking Trail Recommendations</h1>
                <p class="subtitle">Tune the visitor profile and context to jump directly into personalised suggestions.</p>
            </header>

            <form method="post" class="context-form compact">
                <div class="form-section">
                    <label for="user_id">Persona</label>
                    <select name="user_id" id="user_id" required>
                        {% for user in users %}
                            <option value="{{ user.id }}">
                                {{ user.name }} ({{ user.experience }} ¬∑ {{ user.fitness_level }})
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-grid">
                    <label>
                        <span>Start Date</span>
                        <input type="date" name="hike_start_date" id="hike_start_date" required>
                    </label>
                    <label>
                        <span>End Date</span>
                        <input type="date" name="hike_end_date" id="hike_end_date">
                    </label>
                    <!-- Days and hours calculated in background from date range -->
                    <input type="hidden" name="time_available_days" id="time_available_days" value="0">
                    <input type="hidden" name="time_available_hours" id="time_available_hours" value="0">
                    <label>
                        <span>Device</span>
                        <select name="device">
                            <option value="laptop" selected>Laptop</option>
                            <option value="desktop">Desktop</option>
                            <option value="mobile">Mobile</option>
                            <option value="tablet">Tablet</option>
                        </select>
                    </label>
                    <label>
                        <span>Weather</span>
                        <select name="weather">
                            <option value="sunny">Sunny</option>
                            <option value="cloudy">Cloudy</option>
                            <option value="rainy">Rainy</option>
                            <option value="storm_risk">Storm Risk</option>
                            <option value="snowy">Snowy</option>
                        </select>
                    </label>
                    <label>
                        <span>Connection</span>
                        <select name="connection">
                            <option value="strong">Strong</option>
                            <option value="medium">Medium</option>
                            <option value="weak">Weak</option>
                        </select>
                    </label>
                    <label>
                        <span>Season</span>
                        <select name="season" id="season">
                            <option value="spring">Spring</option>
                            <option value="summer">Summer</option>
                            <option value="fall">Fall</option>
                            <option value="winter">Winter</option>
                        </select>
                    </label>
                </div>

                <button type="submit" class="btn-primary">Find My Trails</button>
            </form>
            
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const startDateInput = document.getElementById('hike_start_date');
                    const endDateInput = document.getElementById('hike_end_date');
                    const daysInput = document.getElementById('time_available_days');
                    const hoursInput = document.getElementById('time_available_hours');
                    const seasonSelect = document.getElementById('season');
                    
                    // Function to get current season based on date
                    function getCurrentSeason(date) {
                        const month = date.getMonth() + 1; // getMonth() returns 0-11
                        if (month >= 3 && month <= 5) return 'spring';
                        if (month >= 6 && month <= 8) return 'summer';
                        if (month >= 9 && month <= 11) return 'fall';
                        return 'winter'; // December, January, February
                    }
                    
                    // Set default start date to today
                    if (!startDateInput.value) {
                        const today = new Date().toISOString().split('T')[0];
                        startDateInput.value = today;
                    }
                    
                    // Set season to current season
                    if (seasonSelect) {
                        const currentSeason = getCurrentSeason(new Date());
                        seasonSelect.value = currentSeason;
                    }
                    
                    // Set end date min to start date
                    startDateInput.addEventListener('change', function() {
                        endDateInput.min = startDateInput.value;
                        if (endDateInput.value && endDateInput.value < startDateInput.value) {
                            endDateInput.value = startDateInput.value;
                        }
                        calculateTimeAvailable();
                    });
                    
                    endDateInput.addEventListener('change', function() {
                        calculateTimeAvailable();
                    });
                    
                    // Calculate days and hours from date range in background
                    function calculateTimeAvailable() {
                        const startDate = startDateInput.value;
                        const endDate = endDateInput.value || startDate;
                        
                        if (!startDate) return;
                        
                        const start = new Date(startDate);
                        const end = new Date(endDate);
                        start.setHours(0, 0, 0, 0);
                        end.setHours(0, 0, 0, 0);
                        
                        const diffTime = end - start;
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        
                        if (daysInput) {
                            daysInput.value = Math.max(0, diffDays).toString();
                        }
                        // Hours always 0 since we removed hours input
                        if (hoursInput) {
                            hoursInput.value = '0';
                        }
                    }
                    
                    // Set initial min for end date
                    if (startDateInput.value) {
                        endDateInput.min = startDateInput.value;
                    }
                    
                    calculateTimeAvailable(); // Initial call
                });
            </script>

            <div class="inline-links">
                <a href="{{ url_for('all_trails') }}">Browse entire catalogue ‚Üí</a>
            </div>
        </div>

        <div class="hero-panel hero-highlight">
            <p class="eyebrow">Live demo</p>
            <h2>Showcase contextual adaptation</h2>
            <p>Drive the comparison with bespoke scenarios, map-first views, and card-first narratives. Perfect for presentations.</p>
            <ul class="highlight-list">
                <li>Side-by-side context comparisons</li>
                <li>Interactive map + relevance cards</li>
                <li>Explainable rule activation logs</li>
            </ul>
            <a href="{{ url_for('demo') }}" class="btn-primary">Launch Demo Mode</a>
        </div>
    </div>
{% endblock %}
