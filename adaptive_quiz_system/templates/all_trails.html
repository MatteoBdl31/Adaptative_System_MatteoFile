{% extends "base.html" %}
{% block title %}All Available Trails{% endblock %}
{% block page_class %}list-page{% endblock %}
{% block extra_head %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
{% endblock %}
{% block content %}
    <div class="container">
        <header>
            <h1>üó∫Ô∏è All Available Trails</h1>
            <nav class="nav-links">
                <a href="{{ url_for('demo') }}">Demo</a>
                <a href="{{ url_for('admin_rules') }}">Admin Rules</a>
            </nav>
        </header>

        <div class="filter-section">
            <h3>Filter Trails</h3>
            <div class="filter-group">
                <label for="filter-difficulty">Difficulty:</label>
                <select id="filter-difficulty">
                    <option value="">All</option>
                    <option value="easy">Easy (‚â§3)</option>
                    <option value="medium">Medium (4-6)</option>
                    <option value="hard">Hard (‚â•7)</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-landscape">Landscape:</label>
                <select id="filter-landscape">
                    <option value="">All</option>
                    <option value="lake">Lake</option>
                    <option value="forest">Forest</option>
                    <option value="peaks">Peaks</option>
                    <option value="mountain">Mountain</option>
                    <option value="alpine">Alpine</option>
                    <option value="river">River</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-type">Type:</label>
                <select id="filter-type">
                    <option value="">All</option>
                    <option value="loop">Loop</option>
                    <option value="one_way">One Way</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-distance">Max Distance (km):</label>
                <input type="number" id="filter-distance" placeholder="No limit" min="0" step="0.5">
            </div>
            <button onclick="applyFilters()" class="btn-secondary" style="margin-top: 20px;">Apply Filters</button>
            <button onclick="clearFilters()" class="btn-secondary" style="margin-top: 20px;">Clear Filters</button>
        </div>

        <div class="connection-status" id="connection-status" style="margin: 20px 0; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px; display: none;">
            <span id="connection-indicator">üì∂</span>
            <span id="connection-text">Detecting connection...</span>
        </div>

        <div class="view-toggle">
            <button onclick="showView('map')" id="btn-map" class="active">üó∫Ô∏è Map View</button>
            <button onclick="showView('list')" id="btn-list">üìã List View</button>
            <button onclick="showView('cards')" id="btn-cards" style="display: none;">üÉè Card View</button>
        </div>

        <!-- Map View -->
        <div id="map-view" class="view-section active">
            <h2>Trail Locations on Map</h2>
            <div id="trails-map"></div>
        </div>

        <!-- Card View (for strong connection) -->
        <div id="cards-view" class="view-section">
            <h2>All Trails ({{ trails|length }})</h2>
            <div class="trails-card-view" id="trails-cards">
                {% for trail in trails %}
                <div class="trail-card-with-map" data-difficulty="{{ trail.difficulty }}" 
                     data-landscape="{{ trail.landscapes }}" data-type="{{ trail.trail_type }}"
                     data-distance="{{ trail.distance }}" data-trail-id="{{ trail.trail_id }}"
                     data-lat="{{ trail.latitude }}" data-lon="{{ trail.longitude }}"
                     data-coordinates="{% if trail.coordinates %}{{ trail.coordinates|tojson }}{% else %}null{% endif %}">
                    <div class="trail-card-map-container">
                        <div class="trail-mini-map" id="mini-map-{{ trail.trail_id }}"></div>
                    </div>
                    <div class="trail-card-content">
                        <h3>{{ trail.name }}</h3>
                        <div class="trail-stats">
                            <span class="difficulty-badge difficulty-{{ 'easy' if trail.difficulty <= 3 else 'medium' if trail.difficulty <= 6 else 'hard' }}">
                                {% if trail.difficulty <= 3 %}Easy
                                {% elif trail.difficulty <= 6 %}Medium
                                {% else %}Hard{% endif %}
                            </span>
                            <span>üìè {{ trail.distance }} km</span>
                            <span>‚è±Ô∏è {{ trail.duration|format_duration }}</span>
                            <span>‚õ∞Ô∏è {{ trail.elevation_gain }}m</span>
                        </div>
                        <p class="trail-description">{{ trail.description }}</p>
                        <div class="trail-features">
                            <div class="landscapes">
                                {% for landscape in trail.landscapes.split(',') %}
                                <span class="landscape-tag">{{ landscape.strip() }}</span>
                                {% endfor %}
                            </div>
                            <div class="accessibility">
                                {% if trail.accessibility %}
                                <span class="access-tag">{{ trail.accessibility.split(',')[0] }}</span>
                                {% endif %}
                            </div>
                        </div>
                        <div style="margin-top: 10px;">
                            <strong>Type:</strong> {{ trail.trail_type.replace('_', ' ').title() }} | 
                            <strong>Popularity:</strong> ‚≠ê {{ trail.popularity }}/10
                        </div>
                        {% if trail.latitude and trail.longitude %}
                        <a href="#" onclick="showTrailOnMap({{ trail.latitude }}, {{ trail.longitude }}); return false;" 
                           class="btn-secondary" style="margin-top: 10px;">üìç Show on Map</a>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- List View (for weak connection) -->
        <div id="list-view" class="view-section">
            <h2>All Trails ({{ trails|length }})</h2>
            <div class="trails-list-view" id="trails-list">
                {% for trail in trails %}
                <div class="trail-card" data-difficulty="{{ trail.difficulty }}" 
                     data-landscape="{{ trail.landscapes }}" data-type="{{ trail.trail_type }}"
                     data-distance="{{ trail.distance }}" data-trail-id="{{ trail.trail_id }}">
                    {% if trail.latitude and trail.longitude %}
                    <div class="trail-image-placeholder">
                        üèûÔ∏è
                    </div>
                    {% endif %}
                    <div class="trail-content">
                        <h3>{{ trail.name }}</h3>
                        <div class="trail-stats">
                            <span class="difficulty-badge difficulty-{{ 'easy' if trail.difficulty <= 3 else 'medium' if trail.difficulty <= 6 else 'hard' }}">
                                {% if trail.difficulty <= 3 %}Easy
                                {% elif trail.difficulty <= 6 %}Medium
                                {% else %}Hard{% endif %}
                            </span>
                            <span>üìè {{ trail.distance }} km</span>
                            <span>‚è±Ô∏è {{ trail.duration|format_duration }}</span>
                            <span>‚õ∞Ô∏è {{ trail.elevation_gain }}m</span>
                        </div>
                        <p class="trail-description">{{ trail.description }}</p>
                        <div class="trail-features">
                            <div class="landscapes">
                                {% for landscape in trail.landscapes.split(',') %}
                                <span class="landscape-tag">{{ landscape.strip() }}</span>
                                {% endfor %}
                            </div>
                            <div class="accessibility">
                                {% if trail.accessibility %}
                                <span class="access-tag">{{ trail.accessibility.split(',')[0] }}</span>
                                {% endif %}
                            </div>
                        </div>
                        <div style="margin-top: 10px;">
                            <strong>Type:</strong> {{ trail.trail_type.replace('_', ' ').title() }} | 
                            <strong>Popularity:</strong> ‚≠ê {{ trail.popularity }}/10
                        </div>
                        {% if trail.latitude and trail.longitude %}
                        <a href="#" onclick="showTrailOnMap({{ trail.latitude }}, {{ trail.longitude }}); return false;" 
                           class="btn-secondary" style="margin-top: 10px;">üìç Show on Map</a>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}
{% block extra_scripts %}
    <script>
        // Global variables for map and trails
        var map = null;
        var markers = [];
        var polylines = [];
        var currentTrails = [];
        var connectionStrength = 'strong'; // Default to strong, will be detected
        var miniMaps = {}; // Store mini maps for card view
        
        // Connection detection function
        function detectConnection() {
            return new Promise(function(resolve) {
                // Check if navigator.connection is available (Network Information API)
                if ('connection' in navigator) {
                    var conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                    if (conn) {
                        // Use effectiveType if available (Chrome/Edge)
                        if (conn.effectiveType) {
                            var effectiveType = conn.effectiveType;
                            if (effectiveType === 'slow-2g' || effectiveType === '2g') {
                                resolve('weak');
                                return;
                            } else if (effectiveType === '3g') {
                                // For 3g, check downlink speed if available
                                if (conn.downlink !== undefined && conn.downlink < 1.5) {
                                    resolve('weak');
                                    return;
                                }
                                // Otherwise test with a small download
                                testConnectionSpeed().then(function(isFast) {
                                    resolve(isFast ? 'strong' : 'weak');
                                });
                                return;
                            } else {
                                // 4g or better
                                resolve('strong');
                                return;
                            }
                        }
                        // Use downlink if available (Mbps)
                        if (conn.downlink !== undefined) {
                            if (conn.downlink < 0.5) {
                                resolve('weak');
                                return;
                            } else if (conn.downlink < 1.5) {
                                // Test with a small download for borderline cases
                                testConnectionSpeed().then(function(isFast) {
                                    resolve(isFast ? 'strong' : 'weak');
                                });
                                return;
                            } else {
                                resolve('strong');
                                return;
                            }
                        }
                    }
                }
                
                // Fallback: test connection speed with a small download
                testConnectionSpeed().then(function(isFast) {
                    resolve(isFast ? 'strong' : 'weak');
                });
            });
        }
        
        // Test connection speed by downloading a small resource
        function testConnectionSpeed() {
            return new Promise(function(resolve) {
                var startTime = Date.now();
                var timeoutId;
                
                // Try using fetch API for more reliable testing
                if ('fetch' in window) {
                    // Use a small endpoint - try to fetch the current page's HTML head
                    fetch(window.location.href, {
                        method: 'HEAD',
                        cache: 'no-cache'
                    }).then(function(response) {
                        clearTimeout(timeoutId);
                        var endTime = Date.now();
                        var duration = endTime - startTime;
                        // If it takes more than 2 seconds, consider it weak
                        resolve(duration < 2000);
                    }).catch(function() {
                        clearTimeout(timeoutId);
                        // If fetch fails, assume weak connection
                        resolve(false);
                    });
                    
                    // Timeout after 3 seconds
                    timeoutId = setTimeout(function() {
                        resolve(false); // Assume weak if timeout
                    }, 3000);
                } else {
                    // Fallback: assume strong if we can't test
                    // This is safer for user experience
                    resolve(true);
                }
            });
        }
        
        // Initialize connection detection and set default view
        function initializeConnection() {
            detectConnection().then(function(strength) {
                connectionStrength = strength;
                var statusEl = document.getElementById('connection-status');
                var indicatorEl = document.getElementById('connection-indicator');
                var textEl = document.getElementById('connection-text');
                var cardsBtn = document.getElementById('btn-cards');
                
                if (strength === 'weak') {
                    indicatorEl.textContent = 'üì∂';
                    textEl.textContent = 'Weak connection detected - Using lightweight view';
                    statusEl.style.background = 'rgba(239, 68, 68, 0.2)';
                    statusEl.style.display = 'block';
                    cardsBtn.style.display = 'none';
                    // Ensure list view is shown for weak connection
                    if (!document.getElementById('list-view').classList.contains('active')) {
                        showView('list');
                    }
                } else {
                    indicatorEl.textContent = 'üì∂';
                    textEl.textContent = 'Strong connection detected - Card view with maps available';
                    statusEl.style.background = 'rgba(34, 197, 94, 0.2)';
                    statusEl.style.display = 'block';
                    cardsBtn.style.display = 'inline-block';
                    // Show card view by default for strong connection
                    showView('cards');
                    // Initialize mini maps after a short delay
                    setTimeout(function() {
                        initializeMiniMaps();
                    }, 500);
                }
            });
        }
        
        // Initialize mini maps for card view
        function initializeMiniMaps() {
            if (typeof L === 'undefined') return;
            
            var cardElements = document.querySelectorAll('.trail-card-with-map');
            cardElements.forEach(function(card) {
                var trailId = card.getAttribute('data-trail-id');
                var lat = parseFloat(card.getAttribute('data-lat'));
                var lon = parseFloat(card.getAttribute('data-lon'));
                var mapContainer = document.getElementById('mini-map-' + trailId);
                
                if (!mapContainer || !lat || !lon) return;
                
                try {
                    var miniMap = L.map('mini-map-' + trailId, {
                        zoomControl: false,
                        attributionControl: false,
                        dragging: false,
                        touchZoom: false,
                        doubleClickZoom: false,
                        scrollWheelZoom: false,
                        boxZoom: false,
                        keyboard: false
                    }).setView([lat, lon], 12);
                    
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        maxZoom: 19
                    }).addTo(miniMap);
                    
                    // Add marker
                    L.marker([lat, lon]).addTo(miniMap);
                    
                    // Add trail path if coordinates available
                    var coordinatesStr = card.getAttribute('data-coordinates');
                    if (coordinatesStr && coordinatesStr !== 'null') {
                        try {
                            var coordinates = JSON.parse(coordinatesStr);
                            if (coordinates && coordinates.coordinates && Array.isArray(coordinates.coordinates)) {
                                var latLngs = coordinates.coordinates.map(function(coord) {
                                    return [coord[1], coord[0]];
                                });
                                L.polyline(latLngs, {
                                    color: '#667eea',
                                    weight: 3,
                                    opacity: 0.7
                                }).addTo(miniMap);
                                
                                // Fit bounds to show the trail
                                var bounds = L.latLngBounds(latLngs);
                                miniMap.fitBounds(bounds, {padding: [10, 10]});
                            }
                        } catch(e) {
                            console.log('Could not parse coordinates for mini map:', e);
                        }
                    }
                    
                    miniMaps[trailId] = miniMap;
                    
                    // Invalidate size after a short delay to ensure proper rendering
                    setTimeout(function() {
                        miniMap.invalidateSize();
                    }, 100);
                } catch(e) {
                    console.error('Error initializing mini map for trail ' + trailId + ':', e);
                }
            });
        }
        
        // Wait for DOM and Leaflet to be ready before initializing map
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize connection detection first
            initializeConnection();
            
            // Check if Leaflet is loaded
            if (typeof L === 'undefined') {
                console.error('Leaflet library not loaded!');
                return;
            }
            
            // Check if map container exists
            var mapContainer = document.getElementById('trails-map');
            if (!mapContainer) {
                console.error('Map container not found!');
                return;
            }
            
            // Wait a bit to ensure the container is visible
            setTimeout(function() {
                try {
                    // Check if container is visible
                    var mapView = document.getElementById('map-view');
                    if (mapView && !mapView.classList.contains('active')) {
                        console.log('Map view is hidden, will initialize when shown');
                    }
                    
                    // Initialize map
                    map = L.map('trails-map').setView([45.8, 6.5], 8);
                    
                    // Add OpenStreetMap tiles
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                        maxZoom: 19
                    }).addTo(map);
                    
                    // Invalidate map size to ensure it renders properly
                    setTimeout(function() {
                        if (map) {
                            map.invalidateSize();
                            console.log('Map size invalidated');
                        }
                    }, 200);
                    
                    console.log('Map initialized successfully');
                } catch(e) {
                    console.error('Error initializing map:', e);
                    return;
                }
                
                // Continue with trail data processing
                processTrailData();
            }, 100);
            
            function processTrailData() {

                // Trail data from server
                window.trailsData = [
                {% for trail in trails %}
                {% if trail.latitude and trail.longitude %}
                {
                    id: "{{ trail.trail_id }}",
                    name: {{ trail.name|tojson }},
                    lat: {{ trail.latitude }},
                    lon: {{ trail.longitude }},
                    difficulty: {{ trail.difficulty }},
                    distance: {% if trail.distance is not none %}{{ trail.distance }}{% else %}null{% endif %},
                    duration: {{ trail.duration }},
                    elevation: {% if trail.elevation_gain is not none %}{{ trail.elevation_gain }}{% else %}null{% endif %},
                    landscapes: {{ trail.landscapes|tojson }},
                    type: {{ trail.trail_type|tojson }},
                    description: {{ trail.description|tojson }},
                    popularity: {{ trail.popularity }},
                    coordinates: {% if trail.coordinates %}{{ trail.coordinates|tojson }}{% else %}null{% endif %}
                }{% if not loop.last %},{% endif %}
                {% endif %}
                {% endfor %}
            ];

                // Set current trails
                currentTrails = window.trailsData;

                // Parse coordinates from JSON string if needed
                window.trailsData.forEach(function(trail) {
                    if (trail.coordinates) {
                        // If coordinates is a string, parse it
                        if (typeof trail.coordinates === 'string') {
                            try {
                                trail.coordinates = JSON.parse(trail.coordinates);
                            } catch(e) {
                                console.log('Could not parse coordinates for trail ' + trail.id + ':', e);
                                trail.coordinates = null;
                            }
                        }
                    }
                });

                // Initialize map with all trails
                addTrailsToMap(window.trailsData);
            }
        });

        // Add markers for all trails
        function addTrailsToMap(trails) {
            if (!map) {
                console.error('Map not initialized!');
                return;
            }
            
            // Clear existing markers and polylines
            markers.forEach(function(marker) {
                map.removeLayer(marker);
            });
            polylines.forEach(function(polyline) {
                map.removeLayer(polyline);
            });
            markers = [];
            polylines = [];

            var bounds = [];
            trails.forEach(function(trail) {
                var marker = L.marker([trail.lat, trail.lon])
                    .addTo(map)
                    .bindPopup(
                        '<strong>' + (trail.name || 'Unnamed Trail') + '</strong><br>' +
                        'Difficulty: ' + (trail.difficulty <= 3 ? 'Easy' : trail.difficulty <= 6 ? 'Medium' : 'Hard') + '<br>' +
                        'Distance: ' + (trail.distance !== null ? trail.distance + ' km' : 'N/A') + '<br>' +
                        'Duration: ' + formatDuration(trail.duration) + '<br>' +
                        'Elevation: ' + (trail.elevation !== null ? trail.elevation + 'm' : 'N/A') + '<br>' +
                        '‚≠ê ' + trail.popularity + '/10'
                    );
                markers.push(marker);
                bounds.push([trail.lat, trail.lon]);

                // Add trail path if coordinates available
                if (trail.coordinates) {
                    // Parse coordinates if it's still a string
                    var coordData = trail.coordinates;
                    if (typeof coordData === 'string') {
                        try {
                            coordData = JSON.parse(coordData);
                        } catch(e) {
                            console.log('Could not parse coordinates for trail ' + trail.id + ':', e);
                            coordData = null;
                        }
                    }
                    
                    if (coordData && coordData.coordinates && Array.isArray(coordData.coordinates)) {
                        // Convert GeoJSON coordinates [lon, lat] to Leaflet [lat, lon]
                        var latLngs = coordData.coordinates.map(function(coord) {
                            return [coord[1], coord[0]];
                        });
                        
                        var polyline = L.polyline(latLngs, {
                            color: '#667eea',
                            weight: 4,
                            opacity: 0.7
                        }).addTo(map);
                        
                        polylines.push(polyline);
                        
                        // Extend bounds to include the entire trail path
                        var polylineBounds = polyline.getBounds();
                        bounds.push(polylineBounds.getSouthWest());
                        bounds.push(polylineBounds.getNorthEast());
                    }
                }
            });

            // Fit map to show all markers
            if (bounds.length > 0) {
                map.fitBounds(bounds, {padding: [50, 50]});
            }
        }

        // Show trail on map (from list view)
        function showTrailOnMap(lat, lon) {
            showView('map');
            if (map) {
                map.setView([lat, lon], 13);
                // Highlight the marker
                markers.forEach(function(marker) {
                    if (Math.abs(marker.getLatLng().lat - lat) < 0.001 && 
                        Math.abs(marker.getLatLng().lng - lon) < 0.001) {
                        marker.openPopup();
                    }
                });
            }
        }

        // View toggle
        function showView(view) {
            document.getElementById('map-view').classList.toggle('active', view === 'map');
            document.getElementById('list-view').classList.toggle('active', view === 'list');
            document.getElementById('cards-view').classList.toggle('active', view === 'cards');
            document.getElementById('btn-map').classList.toggle('active', view === 'map');
            document.getElementById('btn-list').classList.toggle('active', view === 'list');
            document.getElementById('btn-cards').classList.toggle('active', view === 'cards');
            
            // If switching to map view, invalidate map size to ensure it renders
            if (view === 'map' && map) {
                setTimeout(function() {
                    map.invalidateSize();
                }, 100);
            }
            
            // If switching to cards view, initialize mini maps if not already done
            if (view === 'cards' && connectionStrength === 'strong') {
                setTimeout(function() {
                    initializeMiniMaps();
                }, 200);
            }
        }

        // Filter functions
        function applyFilters() {
            var difficultyFilter = document.getElementById('filter-difficulty').value;
            var landscapeFilter = document.getElementById('filter-landscape').value;
            var typeFilter = document.getElementById('filter-type').value;
            var distanceFilter = document.getElementById('filter-distance').value;

            // Get trailsData from the global scope
            var trailsData = currentTrails.length > 0 ? currentTrails : window.trailsData || [];
            
            var filteredTrails = trailsData.filter(function(trail) {
                // Difficulty filter
                if (difficultyFilter === 'easy' && trail.difficulty > 3) return false;
                if (difficultyFilter === 'medium' && (trail.difficulty <= 3 || trail.difficulty > 6)) return false;
                if (difficultyFilter === 'hard' && trail.difficulty <= 6) return false;

                // Landscape filter
                if (landscapeFilter && !trail.landscapes.toLowerCase().includes(landscapeFilter.toLowerCase())) return false;

                // Type filter
                if (typeFilter && trail.type !== typeFilter) return false;

                // Distance filter
                if (distanceFilter && trail.distance !== null && trail.distance > parseFloat(distanceFilter)) return false;

                return true;
            });

            currentTrails = filteredTrails;
            addTrailsToMap(filteredTrails);
            filterList(filteredTrails);
        }

        function filterList(filteredTrails) {
            var trailCards = document.querySelectorAll('.trail-card, .trail-card-with-map');
            
            trailCards.forEach(function(card) {
                var trailId = card.getAttribute('data-trail-id');
                // Check if this trail matches filters
                var difficulty = parseFloat(card.getAttribute('data-difficulty'));
                var landscape = card.getAttribute('data-landscape');
                if (!landscape) landscape = '';
                landscape = landscape.toLowerCase();
                var type = card.getAttribute('data-type');
                var distance = parseFloat(card.getAttribute('data-distance'));

                var difficultyFilter = document.getElementById('filter-difficulty').value;
                var landscapeFilter = document.getElementById('filter-landscape').value;
                var typeFilter = document.getElementById('filter-type').value;
                var distanceFilter = document.getElementById('filter-distance').value;

                var show = true;

                if (difficultyFilter === 'easy' && difficulty > 3) show = false;
                if (difficultyFilter === 'medium' && (difficulty <= 3 || difficulty > 6)) show = false;
                if (difficultyFilter === 'hard' && difficulty <= 6) show = false;
                if (landscapeFilter && !landscape.includes(landscapeFilter.toLowerCase())) show = false;
                if (typeFilter && type !== typeFilter) show = false;
                if (distanceFilter && distance > parseFloat(distanceFilter)) show = false;

                card.style.display = show ? 'block' : 'none';
            });
        }

        function clearFilters() {
            document.getElementById('filter-difficulty').value = '';
            document.getElementById('filter-landscape').value = '';
            document.getElementById('filter-type').value = '';
            document.getElementById('filter-distance').value = '';
            currentTrails = window.trailsData || [];
            addTrailsToMap(currentTrails);
            filterList(currentTrails);
            document.querySelectorAll('.trail-card').forEach(function(card) {
                card.style.display = 'block';
            });
        }
    </script>
{% endblock %}

