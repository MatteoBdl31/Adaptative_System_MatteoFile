{% extends "base.html" %}
{% block title %}Adaptive Trails Â· Demo Mode{% endblock %}
{% block page_class %}demo-page{% endblock %}
{% block extra_head %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
{% endblock %}
{% block content %}
    <div class="demo-container">
        <header class="demo-header">
            <h1 class="demo-header__title">Contextual Trail Recommendations</h1>
            <p class="demo-header__subtitle">Switch personas, craft bespoke contexts, and showcase how the engine adapts.</p>
        </header>

        <section class="demo-controls">
            <form class="demo-form" id="demo-form" method="get">
                <div class="user-scenarios" id="user-scenarios">
                    <!-- User A -->
                    <div class="user-scenario" data-user-index="a">
                        <div class="user-scenario__header">
                            <h3 class="user-scenario__title">User A</h3>
                            <div class="user-scenario__header-actions">
                                {% if selected_user_a %}
                                <a href="{{ url_for('profile', user_id=selected_user_a.id) }}" class="btn btn-secondary btn--sm" title="View Profile Dashboard">ðŸ‘¤ Profile</a>
                                {% endif %}
                                <button type="button" class="btn btn-ghost btn-remove-user" data-user="a" aria-label="Remove user A" style="display: none;">Ã—</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">User Profile</label>
                            <select name="user_id_a" class="form-select" id="user-select-a">
                                {% for person in users %}
                                    <option value="{{ person.id }}" 
                                            {% if person.id == selected_user_id_a %}selected{% endif %}
                                            data-profile="{{ person.detected_profile or '' }}"
                                            data-profile-name="{{ person.detected_profile|profile_name_en if person.detected_profile else '' }}">
                                        {{ person.name }} Â· {{ person.experience }} / {{ person.fitness_level }}{% if person.detected_profile %} / {{ person.detected_profile|profile_name_short }}{% endif %}
                                    </option>
                                {% endfor %}
                            </select>
                            <div class="user-profile-badge" id="profile-badge-a" style="display: {% if selected_user_a and selected_user_a.detected_profile %}inline-block{% else %}none{% endif %};">
                                <strong>Detected Profile:</strong> 
                                <span class="user-profile-badge__name" id="profile-name-a">
                                    {% if selected_user_a and selected_user_a.detected_profile %}
                                        {{ selected_user_a.detected_profile|profile_name_en }}
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        <div class="user-scenario__fields">
                            {% for field in context_fields %}
                                {% set value = context_form_values['a'][field.name] %}
                                <div class="form-group">
                                    <label class="form-label">{{ field.label }}</label>
                                    {% if field.type == 'select' %}
                                        <select name="a_{{ field.name }}" class="form-select">
                                            {% for option in field.options %}
                                                <option value="{{ option }}" {% if option == value %}selected{% endif %}>
                                                    {{ option.replace('_', ' ')|title }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    {% else %}
                                        <input type="{{ field.type }}" name="a_{{ field.name }}" value="{{ value }}" class="form-input"
                                               {% if field.min %}min="{{ field.min }}"{% endif %}
                                               {% if field.max %}max="{{ field.max }}"{% endif %}
                                               {% if field.step %}step="{{ field.step }}"{% endif %}>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- User B (hidden by default) -->
                    <div class="user-scenario hidden" data-user-index="b" id="user-scenario-b">
                        <div class="user-scenario__header">
                            <h3 class="user-scenario__title">User B</h3>
                            <div class="user-scenario__header-actions">
                                {% if selected_user_b %}
                                <a href="{{ url_for('profile', user_id=selected_user_b.id) }}" class="btn btn-secondary btn--sm" title="View Profile Dashboard">ðŸ‘¤ Profile</a>
                                {% endif %}
                                <button type="button" class="btn btn-ghost btn-remove-user" data-user="b" aria-label="Remove user B">Ã—</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">User Profile</label>
                            <select name="user_id_b" class="form-select" disabled id="user-select-b">
                                {% for person in users %}
                                    <option value="{{ person.id }}" 
                                            {% if person.id == selected_user_id_b %}selected{% endif %}
                                            data-profile="{{ person.detected_profile or '' }}"
                                            data-profile-name="{{ person.detected_profile|profile_name_en if person.detected_profile else '' }}">
                                        {{ person.name }} Â· {{ person.experience }} / {{ person.fitness_level }}{% if person.detected_profile %} / {{ person.detected_profile|profile_name_short }}{% endif %}
                                    </option>
                                {% endfor %}
                            </select>
                            <div class="user-profile-badge" id="profile-badge-b" style="display: {% if selected_user_b and selected_user_b.detected_profile %}inline-block{% else %}none{% endif %};">
                                <strong>Detected Profile:</strong> 
                                <span class="user-profile-badge__name" id="profile-name-b">
                                    {% if selected_user_b and selected_user_b.detected_profile %}
                                        {{ selected_user_b.detected_profile|profile_name_en }}
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        <div class="user-scenario__fields">
                            {% for field in context_fields %}
                                {% set value = context_form_values['b'][field.name] %}
                                <div class="form-group">
                                    <label class="form-label">{{ field.label }}</label>
                                    {% if field.type == 'select' %}
                                        <select name="b_{{ field.name }}" class="form-select" disabled>
                                            {% for option in field.options %}
                                                <option value="{{ option }}" {% if option == value %}selected{% endif %}>
                                                    {{ option.replace('_', ' ')|title }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    {% else %}
                                        <input type="{{ field.type }}" name="b_{{ field.name }}" value="{{ value }}" class="form-input" disabled
                                               {% if field.min %}min="{{ field.min }}"{% endif %}
                                               {% if field.max %}max="{{ field.max }}"{% endif %}
                                               {% if field.step %}step="{{ field.step }}"{% endif %}>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <div class="demo-actions">
                    <button type="button" class="btn btn-secondary" id="btn-add-user" aria-label="Add another user">
                        + Add Another User
                    </button>
                    <button type="submit" class="btn btn-primary" id="btn-get-trails">
                        <span class="btn-text">Get My Trails</span>
                        <span class="btn-loading hidden">Loading...</span>
                    </button>
                </div>
            </form>
        </section>

        <section class="demo-results {% if compare_mode %}compare{% endif %}" id="demo-results">
            {% if primary_result %}
                <div class="result-panel" data-user="a">
                    {% set result = primary_result %}
                    {% include 'partials/demo_panel.html' %}
                </div>
            {% endif %}
            {% if compare_mode and secondary_result %}
                <div class="result-panel" data-user="b">
                    {% set result = secondary_result %}
                    {% include 'partials/demo_panel.html' %}
                </div>
            {% endif %}
        </section>
    </div>
{% endblock %}
{% block extra_scripts %}
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script src="{{ url_for('static', filename='demo.js') }}"></script>
{% endblock %}