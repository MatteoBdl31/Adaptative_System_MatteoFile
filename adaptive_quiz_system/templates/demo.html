{% extends "base.html" %}
{% block title %}Adaptive Trails · Demo Mode{% endblock %}
{% block page_class %}demo-page{% endblock %}
{% block extra_head %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <style>
        /* Demo-specific styles */
        .demo-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .demo-page .app-header {
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .demo-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-xl) var(--container-padding);
        }

        .demo-header {
            text-align: center;
            margin-bottom: var(--space-2xl);
            color: white;
        }

        .demo-header__title {
            font-size: var(--font-size-4xl);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--space-md);
            color: white;
        }

        .demo-header__subtitle {
            font-size: var(--font-size-lg);
            opacity: 0.9;
            max-width: 60ch;
            margin: 0 auto;
        }

        .demo-controls {
            background: white;
            border-radius: var(--radius-2xl);
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
            box-shadow: var(--shadow-2xl);
        }

        .demo-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
        }

        .user-scenarios {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
        }

        .user-scenario {
            border: 2px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            background: var(--color-bg-secondary);
        }

        .user-scenario__header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-lg);
        }

        .user-scenario__title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
        }

        .user-scenario__fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
        }

        .demo-actions {
            display: flex;
            gap: var(--space-md);
            justify-content: flex-end;
            padding-top: var(--space-lg);
            border-top: 1px solid var(--color-border);
        }

        .demo-results {
            display: grid;
            gap: var(--space-xl);
        }

        .demo-results.compare {
            grid-template-columns: repeat(2, 1fr);
        }

        @media (max-width: 1024px) {
            .demo-results.compare {
                grid-template-columns: 1fr;
            }
        }

        .result-panel {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            box-shadow: var(--shadow-xl);
        }

        .result-panel__header {
            margin-bottom: var(--space-lg);
        }

        .result-panel__title {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-sm);
        }

        .result-panel__description {
            color: var(--color-text-secondary);
        }

        .context-pills {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }

        .view-toggle {
            display: flex;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
            padding: var(--space-sm);
            background: var(--color-bg-secondary);
            border-radius: var(--radius-lg);
        }

        .view-section {
            display: none;
        }

        .view-section.active {
            display: block;
        }

        .trail-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .trail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-lg);
        }

        .trail-item {
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            transition: all var(--transition-base);
        }

        .trail-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .trail-item.recommended {
            border-left: 4px solid var(--color-primary);
        }

        .trail-item.suggested {
            border-left: 4px solid var(--color-accent);
        }

        .map-container {
            width: 100%;
            height: 500px;
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: var(--space-lg);
        }

        .empty-state {
            text-align: center;
            padding: var(--space-3xl);
            color: var(--color-text-muted);
        }
    </style>
{% endblock %}
{% block content %}
    <div class="demo-container">
        <header class="demo-header">
            <h1 class="demo-header__title">Contextual Trail Recommendations</h1>
            <p class="demo-header__subtitle">Switch personas, craft bespoke contexts, and showcase how the engine adapts.</p>
        </header>

        <section class="demo-controls">
            <form class="demo-form" id="demo-form" method="get">
                <div class="user-scenarios" id="user-scenarios">
                    <!-- User A -->
                    <div class="user-scenario" data-user-index="a">
                        <div class="user-scenario__header">
                            <h3 class="user-scenario__title">User A</h3>
                            <button type="button" class="btn btn-ghost btn-remove-user" data-user="a" aria-label="Remove user A" style="display: none;">×</button>
                        </div>
                        <div class="form-group">
                            <label class="form-label">User Profile</label>
                            <select name="user_id_a" class="form-select" id="user-select-a">
                                {% for person in users %}
                                    <option value="{{ person.id }}" 
                                            {% if person.id == selected_user_id_a %}selected{% endif %}
                                            data-profile="{{ person.detected_profile or '' }}"
                                            data-profile-name="{{ person.detected_profile|profile_name_en if person.detected_profile else '' }}">
                                        {{ person.name }} · {{ person.experience }} / {{ person.fitness_level }}{% if person.detected_profile %} / {{ person.detected_profile|profile_name_short }}{% endif %}
                                    </option>
                                {% endfor %}
                            </select>
                            <div class="user-profile-badge" id="profile-badge-a" style="margin-top: 8px; padding: 8px 12px; background-color: #f0f0f0; border-radius: 6px; display: {% if selected_user_a and selected_user_a.detected_profile %}inline-block{% else %}none{% endif %};">
                                <strong>Detected Profile:</strong> 
                                <span style="color: #667eea; font-weight: 600;" id="profile-name-a">
                                    {% if selected_user_a and selected_user_a.detected_profile %}
                                        {{ selected_user_a.detected_profile|profile_name_en }}
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        <div class="user-scenario__fields">
                            {% for field in context_fields %}
                                {% set value = context_form_values['a'][field.name] %}
                                <div class="form-group">
                                    <label class="form-label">{{ field.label }}</label>
                                    {% if field.type == 'select' %}
                                        <select name="a_{{ field.name }}" class="form-select">
                                            {% for option in field.options %}
                                                <option value="{{ option }}" {% if option == value %}selected{% endif %}>
                                                    {{ option.replace('_', ' ')|title }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    {% else %}
                                        <input type="{{ field.type }}" name="a_{{ field.name }}" value="{{ value }}" class="form-input"
                                               {% if field.min %}min="{{ field.min }}"{% endif %}
                                               {% if field.max %}max="{{ field.max }}"{% endif %}
                                               {% if field.step %}step="{{ field.step }}"{% endif %}>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- User B (hidden by default) -->
                    <div class="user-scenario hidden" data-user-index="b" id="user-scenario-b">
                        <div class="user-scenario__header">
                            <h3 class="user-scenario__title">User B</h3>
                            <button type="button" class="btn btn-ghost btn-remove-user" data-user="b" aria-label="Remove user B">×</button>
                        </div>
                        <div class="form-group">
                            <label class="form-label">User Profile</label>
                            <select name="user_id_b" class="form-select" disabled id="user-select-b">
                                {% for person in users %}
                                    <option value="{{ person.id }}" 
                                            {% if person.id == selected_user_id_b %}selected{% endif %}
                                            data-profile="{{ person.detected_profile or '' }}"
                                            data-profile-name="{{ person.detected_profile|profile_name_en if person.detected_profile else '' }}">
                                        {{ person.name }} · {{ person.experience }} / {{ person.fitness_level }}{% if person.detected_profile %} / {{ person.detected_profile|profile_name_short }}{% endif %}
                                    </option>
                                {% endfor %}
                            </select>
                            <div class="user-profile-badge" id="profile-badge-b" style="margin-top: 8px; padding: 8px 12px; background-color: #f0f0f0; border-radius: 6px; display: {% if selected_user_b and selected_user_b.detected_profile %}inline-block{% else %}none{% endif %};">
                                <strong>Detected Profile:</strong> 
                                <span style="color: #667eea; font-weight: 600;" id="profile-name-b">
                                    {% if selected_user_b and selected_user_b.detected_profile %}
                                        {{ selected_user_b.detected_profile|profile_name_en }}
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        <div class="user-scenario__fields">
                            {% for field in context_fields %}
                                {% set value = context_form_values['b'][field.name] %}
                                <div class="form-group">
                                    <label class="form-label">{{ field.label }}</label>
                                    {% if field.type == 'select' %}
                                        <select name="b_{{ field.name }}" class="form-select" disabled>
                                            {% for option in field.options %}
                                                <option value="{{ option }}" {% if option == value %}selected{% endif %}>
                                                    {{ option.replace('_', ' ')|title }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    {% else %}
                                        <input type="{{ field.type }}" name="b_{{ field.name }}" value="{{ value }}" class="form-input" disabled
                                               {% if field.min %}min="{{ field.min }}"{% endif %}
                                               {% if field.max %}max="{{ field.max }}"{% endif %}
                                               {% if field.step %}step="{{ field.step }}"{% endif %}>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <div class="demo-actions">
                    <button type="button" class="btn btn-secondary" id="btn-add-user" aria-label="Add another user">
                        + Add Another User
                    </button>
                    <button type="submit" class="btn btn-primary" id="btn-get-trails">
                        <span class="btn-text">Get My Trails</span>
                        <span class="btn-loading hidden">Loading...</span>
                    </button>
                </div>
            </form>
        </section>

        <section class="demo-results {% if compare_mode %}compare{% endif %}" id="demo-results">
            {% if primary_result %}
                <div class="result-panel" data-user="a">
                    {% set result = primary_result %}
                    {% include 'partials/demo_panel.html' %}
                </div>
            {% endif %}
            {% if compare_mode and secondary_result %}
                <div class="result-panel" data-user="b">
                    {% set result = secondary_result %}
                    {% include 'partials/demo_panel.html' %}
                </div>
            {% endif %}
        </section>
    </div>
{% endblock %}
{% block extra_scripts %}
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script src="{{ url_for('static', filename='demo.js') }}"></script>
{% endblock %}